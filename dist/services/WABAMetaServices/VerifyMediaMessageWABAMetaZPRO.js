'use strict';
const _0x132afa = _0x5f05;
function _0x1f87() {
    const _0x38b213 = [
        'n8n',
        'ookService',
        'done',
        'ook',
        'findOne',
        ':\x20enviarWe',
        '688518QGtqhM',
        'defineProp',
        'getTime',
        'has',
        '34272gONqEH',
        'attributes',
        '28KDfSsn',
        'assign',
        ':\x20Processi',
        'รก\x20processa',
        'fromMe',
        ':\x20WABA\x20msg',
        '55qnICYC',
        '830DBXKzA',
        'apply',
        'where',
        'warn',
        'DQCMS',
        'enviarWebh',
        'payload',
        '../Message',
        'ate',
        './GetMedia',
        'MPsuu',
        'geServiceZ',
        'fault',
        '\x20already\x20p',
        'mw_zpro/tv',
        'ZKsrC',
        ':::\x20ZDG\x20::',
        'IghzK',
        'findAll',
        'sended',
        'ZPRO',
        'BACKEND_UR',
        'ookN8N',
        'Mensagem\x20j',
        '5IZGhEq',
        'sage',
        'cess\x20succe',
        'logger',
        '../../bz7a',
        'qPRhy',
        'node-cache',
        'template',
        'webhook',
        'da\x204:\x20',
        'VywrD',
        'tenantId',
        'type',
        'cquMv',
        'PRO',
        'OBugr',
        'nHhoC',
        'text',
        'efOYB',
        'bhook\x20erro',
        'webhookMes',
        'messageDat',
        'env',
        ':\x20\x20WABA\x20pr',
        'ticket',
        'reateMessa',
        'mUPNr',
        'messageId',
        'throw',
        'n8nStatus',
        'kAyPJ',
        'fdnGu',
        'hYbVM',
        'chat',
        '98073rNiXCC',
        'mmfCE',
        'rffhY',
        'enabled',
        '4MkNtWG',
        'error',
        'webhookUrl',
        'ticket:upd',
        'exrJJ',
        'set',
        'ocess\x20erro',
        '7778028LkPuoE',
        'bkaJd',
        'then',
        'update',
        'body',
        'ng\x20WABA\x20ms',
        '7tljfp_zpr',
        '/public/',
        'torpd',
        'mtVLv',
        './WABAMeta',
        'PgKju',
        'g\x204:\x20',
        '__esModule',
        '1030897mFavFB',
        'next',
        'rocessed\x204',
        'channel',
        'default',
        'pSsie',
        'r\x204:\x20',
        'ls/Message',
        'bp8dlkc2o_',
        'HandleWebh',
        'BAFXb',
        'Mixwa',
        'jlncX',
        'timestamp',
        '991455wWSfxT',
        '__importDe',
        'info',
        'zpro',
        'received',
        'ss\x204:\x20',
        'WABAMetaZP',
        '4918488gxEAuP',
        'JwWhQ',
        '../../974u',
        'includes',
        ':::\x20Z-PRO\x20',
        'ofbeD',
        'erty',
        'reduce',
        'value',
        'key',
        'caption',
        'gMZLD',
        'ls/Setting',
        'o/6gb8ypf_',
        'msg',
        '__awaiter',
        ':\x20Waba\x20pro',
        'stdTTL',
        'r:\x20',
        '../../mode',
        'Mgpex',
        'Services/C'
    ];
    _0x1f87 = function () {
        return _0x38b213;
    };
    return _0x1f87();
}
(function (_0x1a7b07, _0x27193b) {
    const _0x3a69b9 = _0x5f05, _0x10bf8f = _0x1a7b07();
    while (!![]) {
        try {
            const _0x379a97 = -parseInt(_0x3a69b9(0x197)) / (0x2166 + 0x144d + -0x35b2) * (parseInt(_0x3a69b9(0x195)) / (-0x25 * -0xe2 + -0x3 * 0xfb + -0x1db7)) + parseInt(_0x3a69b9(0x1ff)) / (0x2545 + 0x51e * -0x3 + 0x57a * -0x4) * (-parseInt(_0x3a69b9(0x1dc)) / (0x1e10 + 0x1 * 0x24eb + -0x4f * 0xd9)) + -parseInt(_0x3a69b9(0x1b6)) / (0x1277 * 0x1 + 0x1 * -0xb2 + -0x11c0) * (parseInt(_0x3a69b9(0x191)) / (0x2264 + -0x255f + 0x301)) + -parseInt(_0x3a69b9(0x1f1)) / (-0x12d * 0x19 + 0x9 * -0x41b + -0x425f * -0x1) + -parseInt(_0x3a69b9(0x206)) / (-0x23b7 + -0x194b + 0x3d0a) + parseInt(_0x3a69b9(0x1d8)) / (-0x13 * -0x169 + 0x1b * -0x5f + -0x10bd) * (-parseInt(_0x3a69b9(0x19e)) / (0x249c + -0xb7e + -0x1914)) + parseInt(_0x3a69b9(0x19d)) / (0x932 + -0xfcb + 0x6a4) * (parseInt(_0x3a69b9(0x1e3)) / (-0x65 * -0x2e + 0xd7c + 0x1 * -0x1f96));
            if (_0x379a97 === _0x27193b)
                break;
            else
                _0x10bf8f['push'](_0x10bf8f['shift']());
        } catch (_0xf9484b) {
            _0x10bf8f['push'](_0x10bf8f['shift']());
        }
    }
}(_0x1f87, 0x1 * 0xeb36c + -0x1 * -0x3826e + 0x21e * -0x3ec));
function _0x5f05(_0x4b038b, _0x3bcca0) {
    const _0x22c809 = _0x1f87();
    return _0x5f05 = function (_0x4f5816, _0x44350b) {
        _0x4f5816 = _0x4f5816 - (0x8aa + -0x24d * -0x2 + -0x257 * 0x5);
        let _0x22cd21 = _0x22c809[_0x4f5816];
        return _0x22cd21;
    }, _0x5f05(_0x4b038b, _0x3bcca0);
}
var __awaiter = this && this[_0x132afa(0x215)] || function (_0x4ed604, _0x1ed7c8, _0x4121e2, _0x4ea3bf) {
        const _0x2c99b9 = _0x132afa, _0x179d35 = {
                'efOYB': function (_0x545808, _0x5c0bce) {
                    return _0x545808(_0x5c0bce);
                },
                'fdnGu': function (_0x3cd668, _0x56f133) {
                    return _0x3cd668 instanceof _0x56f133;
                },
                'pSsie': _0x2c99b9(0x1d2),
                'hYbVM': function (_0x4af017, _0xecd898) {
                    return _0x4af017(_0xecd898);
                }
            };
        function _0x5c5045(_0x43766f) {
            const _0xcd9d15 = _0x2c99b9;
            return _0x179d35[_0xcd9d15(0x1d5)](_0x43766f, _0x4121e2) ? _0x43766f : new _0x4121e2(function (_0x1eb417) {
                const _0x3c8aa5 = _0xcd9d15;
                _0x179d35[_0x3c8aa5(0x1c8)](_0x1eb417, _0x43766f);
            });
        }
        return new (_0x4121e2 || (_0x4121e2 = Promise))(function (_0xbaf229, _0xce9931) {
            const _0x1c8e50 = _0x2c99b9, _0x4c9690 = {
                    'cquMv': function (_0x3b1573, _0x156f46) {
                        const _0x31b857 = _0x5f05;
                        return _0x179d35[_0x31b857(0x1d6)](_0x3b1573, _0x156f46);
                    }
                };
            function _0x59d97c(_0x6245d9) {
                const _0x1b944e = _0x5f05;
                try {
                    _0x4c9690[_0x1b944e(0x1c3)](_0x21f5c8, _0x4ea3bf[_0x1b944e(0x1f2)](_0x6245d9));
                } catch (_0xbea09) {
                    _0x4c9690[_0x1b944e(0x1c3)](_0xce9931, _0xbea09);
                }
            }
            function _0x5d49e4(_0x4334c4) {
                const _0x14d0d1 = _0x5f05;
                try {
                    _0x179d35[_0x14d0d1(0x1c8)](_0x21f5c8, _0x4ea3bf[_0x179d35[_0x14d0d1(0x1f6)]](_0x4334c4));
                } catch (_0x4825ff) {
                    _0x179d35[_0x14d0d1(0x1c8)](_0xce9931, _0x4825ff);
                }
            }
            function _0x21f5c8(_0x2831c0) {
                const _0x1377e6 = _0x5f05;
                _0x2831c0[_0x1377e6(0x21e)] ? _0x179d35[_0x1377e6(0x1d6)](_0xbaf229, _0x2831c0[_0x1377e6(0x20e)]) : _0x179d35[_0x1377e6(0x1d6)](_0x5c5045, _0x2831c0[_0x1377e6(0x20e)])[_0x1377e6(0x1e5)](_0x59d97c, _0x5d49e4);
            }
            _0x179d35[_0x1c8e50(0x1d6)](_0x21f5c8, (_0x4ea3bf = _0x4ea3bf[_0x1c8e50(0x19f)](_0x4ed604, _0x1ed7c8 || []))[_0x1c8e50(0x1f2)]());
        });
    }, __importDefault = this && this[_0x132afa(0x200) + _0x132afa(0x1aa)] || function (_0x5e92cd) {
        const _0x22b8ee = _0x132afa;
        return _0x5e92cd && _0x5e92cd[_0x22b8ee(0x1f0)] ? _0x5e92cd : { 'default': _0x5e92cd };
    };
const _0x52e1f4 = {};
_0x52e1f4[_0x132afa(0x20e)] = !![], Object[_0x132afa(0x192) + _0x132afa(0x20c)](exports, _0x132afa(0x1f0), _0x52e1f4);
const MessageZPRO_1 = __importDefault(require(_0x132afa(0x219) + _0x132afa(0x1f8) + _0x132afa(0x1b2))), CreateMessageServiceZPRO_1 = __importDefault(require(_0x132afa(0x1a5) + _0x132afa(0x21b) + _0x132afa(0x1cf) + _0x132afa(0x1a9) + _0x132afa(0x1c4))), GetMediaWABAMetaZPRO_1 = __importDefault(require(_0x132afa(0x1a7) + _0x132afa(0x205) + 'RO')), _6gb8ypf_zpro_1 = __importDefault(require(_0x132afa(0x208) + _0x132afa(0x1e9) + _0x132afa(0x213) + _0x132afa(0x202))), WABAMetaHandleWebhookServiceZPRO_1 = require(_0x132afa(0x1ed) + _0x132afa(0x1fa) + _0x132afa(0x21d) + _0x132afa(0x1b2)), tvbp8dlkc2o_zpro_1 = require(_0x132afa(0x1ba) + _0x132afa(0x1ac) + _0x132afa(0x1f9) + _0x132afa(0x202)), SettingZPRO_1 = __importDefault(require(_0x132afa(0x219) + _0x132afa(0x212) + _0x132afa(0x1b2))), node_cache_1 = __importDefault(require(_0x132afa(0x1bc)));
function extractCaption(_0x38432c) {
    const _0x152296 = _0x132afa;
    if (!_0x38432c || !_0x38432c[_0x152296(0x1c2)])
        return '';
    const _0x48f8a3 = _0x38432c[_0x38432c[_0x152296(0x1c2)]];
    if (_0x48f8a3 && _0x48f8a3[_0x152296(0x210)])
        return _0x48f8a3[_0x152296(0x210)];
    return '';
}
const VerifyMediaMessage = (_0x1f3d82, _0x1369fe, _0x2025d3, _0xd4dd00) => __awaiter(void (0x134b + -0x2547 + 0x2 * 0x8fe), void (-0x157f + -0x2 * -0x12d1 + -0x51 * 0x33), void (0x307 * 0x1 + -0x12b * 0xd + 0xc28 * 0x1), function* () {
    const _0x123648 = _0x132afa, _0x540639 = {
            'rffhY': _0x123648(0x1d1),
            'MPsuu': _0x123648(0x1c7),
            'BAFXb': _0x123648(0x1d7),
            'ofbeD': _0x123648(0x1bd),
            'Mgpex': function (_0x6000fb, _0x384130) {
                return _0x6000fb(_0x384130);
            },
            'nHhoC': _0x123648(0x1b1),
            'OBugr': _0x123648(0x203),
            'torpd': function (_0x3b6db1, _0x2babfa) {
                return _0x3b6db1 + _0x2babfa;
            },
            'mtVLv': function (_0x5ed1e8, _0xfd456d) {
                return _0x5ed1e8 + _0xfd456d;
            },
            'JwWhQ': function (_0x30fee6, _0xc016dc) {
                return _0x30fee6 + _0xc016dc;
            },
            'IghzK': _0x123648(0x1ea),
            'DQCMS': _0x123648(0x1ca) + _0x123648(0x1b7),
            'PgKju': _0x123648(0x1de),
            'mUPNr': _0x123648(0x1be),
            'ZKsrC': _0x123648(0x21c),
            'gMZLD': function (_0x242dab, _0xfc7257) {
                return _0x242dab === _0xfc7257;
            },
            'VywrD': function (_0x799b05, _0xed3052) {
                return _0x799b05 === _0xed3052;
            },
            'bkaJd': function (_0x16a343, _0x2a2adb) {
                return _0x16a343 === _0x2a2adb;
            },
            'kAyPJ': _0x123648(0x1db),
            'Mixwa': function (_0x328be6, _0x1d59fa) {
                return _0x328be6 + _0x1d59fa;
            },
            'mmfCE': _0x123648(0x20a) + _0x123648(0x1ae) + _0x123648(0x221) + _0x123648(0x1c9) + _0x123648(0x218),
            'qPRhy': function (_0x5b3164, _0x1f0b85) {
                return _0x5b3164 === _0x1f0b85;
            },
            'jlncX': function (_0x3c4ef6, _0x2acdc2) {
                return _0x3c4ef6 === _0x2acdc2;
            },
            'exrJJ': _0x123648(0x1df) + _0x123648(0x1a6)
        };
    var _0x56e6da;
    const _0x1b1597 = {};
    _0x1b1597[_0x123648(0x217)] = 0xa;
    const _0x4b5943 = new node_cache_1[(_0x123648(0x1f5))](_0x1b1597), _0x352187 = _0x1369fe['id'];
    if (!_0x352187)
        return;
    if (_0x4b5943[_0x123648(0x194)](_0x352187)) {
        tvbp8dlkc2o_zpro_1[_0x123648(0x1b9)][_0x123648(0x201)](_0x123648(0x1b5) + _0x123648(0x19a) + _0x123648(0x1bf) + _0x352187);
        return;
    }
    _0x4b5943[_0x123648(0x1e1)](_0x352187, !![]);
    try {
        tvbp8dlkc2o_zpro_1[_0x123648(0x1b9)][_0x123648(0x201)](_0x123648(0x20a) + _0x123648(0x1ae) + _0x123648(0x199) + _0x123648(0x1e8) + _0x123648(0x1ef) + _0x352187);
        const _0x539185 = {};
        _0x539185[_0x123648(0x1d1)] = _0x352187, _0x539185[_0x123648(0x1c1)] = _0x2025d3[_0x123648(0x1c1)];
        const _0x135bd8 = {};
        _0x135bd8[_0x123648(0x1a0)] = _0x539185, _0x135bd8[_0x123648(0x196)] = [
            'id',
            _0x540639[_0x123648(0x1da)]
        ];
        const _0x5c063c = yield MessageZPRO_1[_0x123648(0x1f5)][_0x123648(0x220)](_0x135bd8);
        if (_0x5c063c) {
            tvbp8dlkc2o_zpro_1[_0x123648(0x1b9)][_0x123648(0x201)](_0x123648(0x20a) + _0x123648(0x1ae) + _0x123648(0x19c) + _0x123648(0x1ab) + _0x123648(0x1f3) + ':\x20' + _0x352187);
            return;
        }
        tvbp8dlkc2o_zpro_1[_0x123648(0x1b9)][_0x123648(0x201)](_0x123648(0x20a) + _0x123648(0x1ae) + _0x123648(0x216) + _0x123648(0x1b8) + _0x123648(0x204) + _0x352187);
    } catch (_0xbc4096) {
        tvbp8dlkc2o_zpro_1[_0x123648(0x1b9)][_0x123648(0x1dd)](_0x123648(0x20a) + _0x123648(0x1ae) + _0x123648(0x1cd) + _0x123648(0x1e2) + _0x123648(0x1f7) + _0x352187, _0xbc4096);
    }
    let _0x229120;
    try {
        const _0x8688c2 = {};
        _0x8688c2[_0x123648(0x1f4)] = _0x1f3d82, _0x8688c2[_0x123648(0x214)] = _0x1369fe, _0x8688c2[_0x123648(0x1ce)] = _0x2025d3, _0x229120 = yield (-0xc * -0x55 + -0x1 * -0x8d + -0x489, GetMediaWABAMetaZPRO_1[_0x123648(0x1f5)])(_0x8688c2);
    } catch (_0x4de78c) {
    }
    let _0x181049;
    if (![
            _0x540639[_0x123648(0x1a8)],
            _0x540639[_0x123648(0x1fb)],
            _0x540639[_0x123648(0x20b)]
        ][_0x123648(0x209)](_0x1369fe[_0x123648(0x1c2)])) {
        const _0x325da3 = _0x1369fe;
        _0x181049 = _0x325da3[_0x1369fe[_0x123648(0x1c2)]]['id'];
    }
    const _0x3f1ce3 = {
            'messageId': _0x1369fe['id'] || '',
            'ticketId': _0x2025d3['id'],
            'contactId': _0x1369fe[_0x123648(0x19b)] ? undefined : _0xd4dd00['id'],
            'body': _0x540639[_0x123648(0x21a)](extractCaption, _0x1369fe) || _0x229120 || '',
            'fromMe': _0x1369fe[_0x123648(0x19b)],
            'read': _0x1369fe[_0x123648(0x19b)],
            'mediaUrl': _0x229120,
            'mediaType': _0x1369fe[_0x123648(0x1c2)],
            'timestamp': +_0x1369fe[_0x123648(0x1fe)],
            'wabaMediaId': _0x181049,
            'status': _0x1369fe[_0x123648(0x19b)] ? _0x540639[_0x123648(0x1c6)] : _0x540639[_0x123648(0x1c5)]
        }, _0xb0db4f = Object[_0x123648(0x198)](Object[_0x123648(0x198)]({}, _0x3f1ce3), { 'mediaUrl': _0x540639[_0x123648(0x1eb)](_0x540639[_0x123648(0x1eb)](_0x540639[_0x123648(0x1ec)](_0x540639[_0x123648(0x207)](process[_0x123648(0x1cc)][_0x123648(0x1b3) + 'L'], _0x540639[_0x123648(0x1af)]), _0x2025d3[_0x123648(0x1c1)]), '/'), _0x229120) });
    try {
        const _0x152b31 = [
                _0x540639[_0x123648(0x1a2)],
                _0x540639[_0x123648(0x1ee)],
                _0x540639[_0x123648(0x1d0)]
            ], _0x3a5fe2 = {};
        _0x3a5fe2[_0x123648(0x20f)] = _0x152b31, _0x3a5fe2[_0x123648(0x1c1)] = _0x2025d3[_0x123648(0x1c1)];
        const _0x2e3a5e = {};
        _0x2e3a5e[_0x123648(0x1a0)] = _0x3a5fe2;
        const _0x5544ac = yield SettingZPRO_1[_0x123648(0x1f5)][_0x123648(0x1b0)](_0x2e3a5e), _0x12036a = _0x5544ac[_0x123648(0x20d)]((_0x149d28, _0x21f685) => {
                const _0x5b9783 = _0x123648;
                return _0x149d28[_0x21f685[_0x5b9783(0x20f)]] = _0x21f685, _0x149d28;
            }, {}), _0x2fd5ba = _0x12036a[_0x540639[_0x123648(0x1a2)]], _0x4ea037 = _0x12036a[_0x540639[_0x123648(0x1ee)]], _0x14ef3a = _0x12036a[_0x540639[_0x123648(0x1d0)]], _0x2bc254 = _0x12036a[_0x540639[_0x123648(0x1ad)]];
        yield (0x10 * -0x259 + 0x7f * -0x2f + 0x3ce1, WABAMetaHandleWebhookServiceZPRO_1[_0x123648(0x1a3) + _0x123648(0x21f)])(_0x3f1ce3, _0x2025d3[_0x123648(0x1c1)], _0x2025d3, _0x14ef3a, _0x4ea037, _0x2fd5ba), _0x2bc254 && _0x540639[_0x123648(0x211)](_0x540639[_0x123648(0x1c0)](_0x2bc254, null) || _0x540639[_0x123648(0x1e4)](_0x2bc254, void (-0x1 * -0x1c45 + -0xdd8 + -0xe6d)) ? void (0x12f + 0x2 * -0x803 + 0xed7) : _0x2bc254[_0x123648(0x20e)], _0x540639[_0x123648(0x1d4)]) && _0x2025d3[_0x123648(0x1d3)] && (yield (0x8ef * -0x3 + -0x19ba + 0x3487, WABAMetaHandleWebhookServiceZPRO_1[_0x123648(0x1a3) + _0x123648(0x1b4)])(_0xb0db4f, _0x2025d3, _0x1f3d82));
    } catch (_0xe5db14) {
        tvbp8dlkc2o_zpro_1[_0x123648(0x1b9)][_0x123648(0x1a1)](_0x540639[_0x123648(0x1fc)](_0x540639[_0x123648(0x1d9)], _0xe5db14));
    }
    yield _0x2025d3[_0x123648(0x1e6)]({
        'lastMessage': (_0x540639[_0x123648(0x1e4)](_0x56e6da = _0x540639[_0x123648(0x1bb)](_0x1369fe, null) || _0x540639[_0x123648(0x1fd)](_0x1369fe, void (-0x1568 + -0x2182 + -0x4fe * -0xb)) ? void (0x1 * -0xd45 + -0x23f + -0xf84 * -0x1) : _0x1369fe[_0x123648(0x1c7)], null) || _0x540639[_0x123648(0x1e4)](_0x56e6da, void (0x5a7 * 0x3 + 0x505 + -0x1d * 0xc2)) ? void (-0x1f * 0x15 + -0x3 * 0x3c + 0x33f) : _0x56e6da[_0x123648(0x1e7)]) || _0x229120,
        'lastMessageAt': new Date()[_0x123648(0x193)](),
        'answered': _0x1369fe[_0x123648(0x19b)] || ![],
        'lastMessageReceived': _0x1369fe[_0x123648(0x19b)] ? null : new Date()[_0x123648(0x193)]()
    });
    const _0x81aee1 = {};
    _0x81aee1[_0x123648(0x1cb) + 'a'] = _0x3f1ce3, _0x81aee1[_0x123648(0x1c1)] = _0x2025d3[_0x123648(0x1c1)];
    const _0x192286 = yield (-0x126 * 0x7 + 0x2f3 * 0x3 + 0xcf * -0x1, CreateMessageServiceZPRO_1[_0x123648(0x1f5)])(_0x81aee1), _0x22ae7d = {};
    return _0x22ae7d[_0x123648(0x1c1)] = _0x2025d3[_0x123648(0x1c1)], _0x22ae7d[_0x123648(0x1c2)] = _0x540639[_0x123648(0x1e0)], _0x22ae7d[_0x123648(0x1a4)] = _0x2025d3, (0x3 * 0x100 + 0x2 * -0xe6b + 0x19d6, _6gb8ypf_zpro_1[_0x123648(0x1f5)])(_0x22ae7d), _0x192286;
});
exports[_0x132afa(0x1f5)] = VerifyMediaMessage;